---
title: [JS]节流和防抖
date: 2022-03-31 12:37:24
tags: 
  - JS基础
  - JS面试
categories: JavaScript
copyright: true
comments: true
---
### 节流
```javascript
// 时间戳
function throttled(fn, delay) {
  let begin = 0
  return function() {
    let cur = new Date().getTime()
    if (cur - begin > delay) {
      fn.apply(this, arguments)
      begin = cur
    }
  }
}
// setTimeout
function throttled(fn, delay) {
  let timer = null
  let startTime = Date.now()
  return function(){
    let context = this
    let args = arguments
    let curentTime = Date.now()
    let remainTime = delay - (curentTime - startTime)
    clearTimeout(timer)
    if (remainTime <= 0) {
      fn.apply(context, args)
      startTime = Date.now()
    } else (
      timer = setTimeout(fn, remainTime)
    )
  }
}
```

### 防抖

```javascript
// 简单版本
function debounce(fn, wait) {
  let timer
  return function() {
    timer && clearTimeout(timer)
    timer = setTimeout(() => {
      // 箭头函数没有this, this和arguments为父级函数里的
      fn.apply(this, arguments)
    }, wait)
  }
}

// 默认第一次先执行，http请求慢的时候第一次返回慢，所以需要第一次就立即触发一下函数
function debounce(fn, wait, triggerNow) {
  let timer = null
  return function(){
    let firstClick = !t
    if (t) {clearTimeout(t)} // 清完定时器，t的唯一标识还存在
    if (firstClick) {fn.apply(this, aguments)}
    t = setTimeout(() => {
      t = null
    }, wait)
  }
}

```